<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>

<!-- css모음 -->
<link rel="stylesheet" type="text/css"
	href="/resources/css/custUser/GIMPO/airport.css">
<link rel="stylesheet" type="text/css"
	href="/resources/css/custUser/GIMPO/board.css">
<link rel="stylesheet" type="text/css"
	href="/resources/css/custUser/GIMPO/common.css">
<link rel="stylesheet" type="text/css"
	href="/resources/css/custUser/GIMPO/jquery-ui.css">
<link rel="stylesheet" type="text/css"
	href="/resources/css/custUser/GIMPO/jquery-ui.theme.css">
<link rel="stylesheet" type="text/css"
	href="/resources/css/custUser/GIMPO/kac_n.css">
<link rel="stylesheet" type="text/css"
	href="/resources/css/custUser/GIMPO/kac.css">
<link rel="stylesheet" type="text/css"
	href="/resources/css/custUser/GIMPO/layout.css">
<link rel="stylesheet" type="text/css"
	href="/resources/css/custUser/GIMPO/slick.css">
<link rel="stylesheet" type="text/css"
	href="/resources/css/custUser/parking/boomin.css">
<link rel="stylesheet" type="text/css"
	href="/resources/css/custUser/parking/commons.css">
<link rel="stylesheet" type="text/css"
	href="/resources/css/custUser/parking/common.css">
<link rel="stylesheet" type="text/css"
	href="/resources/css/custUser/parking/reset.css">
<link rel="stylesheet" type="text/css"
	href="/resources/css/custUser/parking/frame1.css">
<link rel="stylesheet" type="text/css"
	href="/resources/css/custUser/parking/style.css">
<link rel="stylesheet" type="text/css"
	href="/resources/css/custUser/parking/jquery.css">
<link rel="stylesheet" type="text/css"
	href="/resources/css/custUser/parking/select2.css">

<div class="siteGoing parking">
	<form id="reservationVO" name="reservationVO"
		action="/reservation/recheck.do" method="post">



		<input type="hidden" name="menuParamNo" value="10000"> <input
			type="hidden" name="upperMenuParamId" value="0"> <input
			type="hidden" name="subMenu1" value="0"> <input type="hidden"
			name="subMenu2" value="0">

		<script>
      

            $(function() {
                $('#reservationVO [name="menuPar

            $(function() {
                $('#reservationVO

            $(function() {
                $('#reservationVO [name="menuParamNo"]').val($('#mainManageLeftForm [name="menuPar

            $(function() {
                $('#reservationVO [name="menuParamNo"]').val($('#mainManageLeftForm 

            $(function() {
                $('#reservationVO [name="menuParamNo"]').val($('#mainMana

            $(function() {
                $('#reservationVO [name="menuParamNo"]').val($('#mainManageLeftForm [name="menuParamNo"]').val());
                $('#reservationVO [name="upperMenuP

            $(function() {
                $('#reservationVO [name="menuParamNo"]').val($('#mainManageLeftForm [name="menuParamNo"]').val());
                $('#reservationVO 

            $(function() {
                $('#reservationVO [name="menuParamNo"]').val($('#mainManageLeftForm [name="menuParamNo"]').val());
                $('#reserv

            $(function() {
                $('#reservationVO [name="menuParamNo"]').val($('#mainManageLeftForm [name="menuParamNo"]').val());
                $('#reservationVO [name="upperMenuParamId"]').val($('#mainManageLeftForm [name="upperMenuParamId"]

            $(function() {
                $('#reservationVO [name="menuParamNo"]').val($('#mainManageLeftForm [name="menuParamNo"]').val());
                $('#reservationVO [name="upperMenuParamId"]').val($('#mainManageLeftForm [name="upperMen

            $(function() {
                $('#reservationVO [name="menuParamNo"]').val($('#mainManageLeftForm [name="menuParamNo"]').val());
                $('#reservationVO [name="upperMenuParamId"]').val($('#mainManageLeftForm [nam

            $(function() {
                $('#reservationVO [name="menuParamNo"]').val($('#mainManageLeftForm [name="menuParamNo"]').val());
                $('#reservationVO [name="upperMenuParamId"]').val($('#mainManage

            $(function() {
                $('#reservationVO [name="menuParamNo"]').val($('#mainManageLeftForm [name="menuParamNo"]').val());
                $('#reservationVO [name="upperMenuParamId"]').val($('#mainManageLeftForm [name="upperMenuParamId"]').val());
                $('#reservationVO [name=

            $(function() {
                $('#reservationVO [name="menuParamNo"]').val($('#mainManageLeftForm [name="menuParamNo"]').val());
                $('#reservationVO [name="upperMenuParamId"]').val($('#mainManageLeftForm [name="upperMenuParamId"]').val());
                $('#reservationVO [name="subMenu1"]').val($('#mainManageLeftForm [name="

            $(function() {
                $('#reservationVO [name="menuParamNo"]').val($('#mainManageLeftForm [name="menuParamNo"]').val());
                $('#reservationVO [name="upperMenuParamId"]').val($('#mainManageLeftForm [name="upperMenuParamId"]').val());
                $('#reservationVO [name="subMenu1"]').val($('#mainManageLeftFo

            $(function() {
                $('#reservationVO [name="menuParamNo"]').val($('#mainManageLeftForm [name="menuParamNo"]').val());
                $('#reservationVO [name="upperMenuParamId"]').val($('#mainManageLeftForm [name="upperMenuParamId"]').val());
                $('#reservationVO [name="subMenu1"]').val($('#mainM

            $(function() {
                $('#reservationVO [name="menuParamNo"]').val($('#mainManageLeftForm [name="menuParamNo"]').val());
                $('#reservationVO [name="upperMenuParamId"]').val($('#mainManageLeftForm [name="upperMenuParamId"]').val());
                $('#reservationVO [name="subMenu1"]').val($('#mainManageLeftForm [name="subMenu1"]').val());
                $('#reservationVO [name="sub

            $(function() {
                $('#reservationVO [name="menuParamNo"]').val($('#mainManageLeftForm [name="menuParamNo"]').val());
                $('#reservationVO [name="upperMenuParamId"]').val($('#mainManageLeftForm [name="upperMenuParamId"]').val());
                $('#reservationVO [name="subMenu1"]').val($('#mainManageLeftForm [name="subMenu1"]').val());
                $('#reservatio

            $(function() {
                $('#reservationVO [name="menuParamNo"]').val($('#mainManageLeftForm [name="menuParamNo"]').val());
                $('#reservationVO [name="upperMenuParamId"]').val($('#mainManageLeftForm [name="upperMenuParamId"]').val());
                $('#reservationVO [name="subMenu1"]').val($('#mainManageLeftForm [name="subMenu1"]').val());
                $('#reservationVO [name="subMenu2"]').val($('#mainManageLeftForm [nam

            $(function() {
                $('#reservationVO [name="menuParamNo"]').val($('#mainManageLeftForm [name="menuParamNo"]').val());
                $('#reservationVO [name="upperMenuParamId"]').val($('#mainManageLeftForm [name="upperMenuParamId"]').val());
                $('#reservationVO [name="subMenu1"]').val($('#mainManageLeftForm [name="subMenu1"]').val());
                $('#reservationVO [name="subMenu2"]').val($('#mainM

            $(function() {
                $('#reservationVO [name="menuParamNo"]').val($('#mainManageLeftForm [name="menuParamNo"]').val());
                $('#reservationVO [name="upperMenuParamId"]').val($('#mainManageLeftForm [name="upperMenuParamId"]').val());
                $('#reservationVO [name="subMenu1"]').val($('#mainManageLeftForm [name="subMenu1"]').val());
                $('#reservationVO [name="subMenu2"]').val($('#mainManageLeftForm [name="subMenu2"]').val());
            });
        </script>

		<input type="hidden" id="parkingName" name="parkingName"> <input
			type="hidden" id="sectnId" name="sectnId">
		<div id="parkingMain">
			<div class="parkingall">
				<!--location-->




				<div class="location">
					<h4 class="subTitle">주차예약</h4>


					<ul class="breadcrumb web">


						<li><a href="/" class="home">Home</a></li>






						<li><a href="/reservation/recheck.do">주차예약</a></li> <


						<li><a href="/reservation/recheck.do">주차예약(주차조회)</a></li>
					</ul>


				</div>







				<div id="subCont">

					<
					<ul class="tabMenu">




						<li class="active"><span>예약가능조회</span></li>




						<li><span>예약신청</span></li>


						<li><span>예약확인</span></li>


					</ul>




					<div class="reserve">


						<p class="titPage">예약정보 입력</p>




						<div class="infoBox">


							<div class="inputArea">


								<div class="row">




									<label for="parkingDivCd">공항</label> <select id="parkingDivCd"
										name="parkingDivCd" title="공항 선택" aria-required="true"
										class="valid ck">






										<option value="" selected="selected">공항 선택</option>


										<option value="PLT-002">ㅇ</option>


										<option value="PLT-003">김해공항</option>




									</select>


								</div>

								<
								<div class="row">


									<label for="parkingNm">주차장</label> <select id="parkingNm"
										name="parkingNm" title="주차장 선택" aria-required="true"
										class="valid ck">






										<option value="" selected="selected">주차장 선택</option>


										<option value="p1">야외주차장</option>


									</select>


								</div>


								<div class="row">




									<label for="resInDttm">입차일자</label> <input id="resInDttm"
										name="resInDttm" title="입차일자 선택" aria-required="true"
										placeholder="예약 입차일을 선택해주세요." class="cal valid ck" type="text">




									<div class="hidden-message warning" id="resInDttmChk"
										style="display: none;">예약입차일시는 필수 선택값입니다.</div>




								</div>


								<div class="row">




									<label for="resOutDttm">출차일자</label> <input id="resOutDttm"
										name="resOutDttm" title="출차일자 선택" aria-required="true"
										placeholder="예약 출차일을 선택해주세요." class="cal valid ck" type="text">


									<div class="hidden-message warning" id="resOutDttmChk"
										style="display: none;">예약출차일시는 필수 선택값입니다.</div>


								</div>


								<div class="row">




									<label for="carKind">차량 종류</label> <select id="carKind"
										name="carKind" title="차량 종류 선택" aria-required="true"
										class="valid ck">




										<option value="DC001">일반 차량</option>




										<option class="showText" value="DC002">장애인 차량</option>


									</select>




								</div>
								<!--//row-->
							</div>
							<!--//inputArea-->
							<!--infoArea-->
							<div class="infoArea web">
								<p class="title">예약 전 반드시 읽어주세요</p>
								<ul class="list">
									<li>[예약 기간]<br> ・최소 2시간부터 최장 30일까지 예약이 가능합니다.
									</li>
									<li>[입차 시간]<br> ・예약시간 기준 2시간 전 및 예약시간 기준 2시간 후 까지는
										예약변경 없이 입차가 가능합니다.
									</li>
									<li>[예약 변경/취소]<br> ・예약의 변경 및 취소는 입차 예정시간 1시간 전까지
										가능합니다. <br>・입차 예정시간 1시간 전 예약한 경우 20분이내에는 예약의 변경 및 취소가
										가능합니다.
									</li>
									<li class="colorType green">[예약부도 및 패널티]<br> ・입차 예정시간
										2시간 경과까지 입차하지 않는 경우 예약 보증금의 100%를 위약금으로 하며, 예약이 취소됩니다. <br>
										・예약일 기준 1년간 2회 이상 예약부도 시 예약 출차일로부터 3개월 동안 공항 주차 예약서비스를 이용할 수
										없습니다.
									</li>
									<li class="showText" style="display: block;">[장애인 차량]<br>
										・장애인 차량 주차면이 별도로 마련되어 있습니다.(엘리베이터 및 에스컬레이터 없음)
									</li>
									<li>[주차요금]<br> ・주차요금은 실제 입출차 시간을 기준으로 부과됩니다.
									</li>
									<li>[안내사항] <br> ※ 대구공항 예약주차장은 2023년 04월 01일부터 운영하지
										않습니다. <br> * 예약주차장 외 다른 주차장은 예약없이 이용 가능합니다.(이용 주차장 만차 시
										대기 발생 참조)
									</li>

								</ul>
								<ul class="list">
									<li class="colorType dkBlue">예상 주차요금 계산기</li>
									<li>[할인적용]<br> ・할인은 출차(유인, 무인) 시 증빙 후 적용됩니다. <span
										class="colorType green"><br>(단, 정부에 등록된 차량(저공해,
											경차, 국가유공상이자 등) 및 공사 홈페이지에 다자녀 사전 등록 차량은 자동 할인 가능)</span>
									</li>
								</ul>
							</div>
							<!--//infoArea-->
						</div>
						<!--btnArea-->
						<div class="btnArea txt-center mt40">


							<button type="button" class="button dkBlue" id="parkCheckBtn">예약가능조회</button>


						</div>
						<!--//btnArea-->
						<!--reserve-->
						<div class="reserve mobile">
							<div class="infoArea">
								<p class="title">예약 전 반드시 읽어주세요</p>
								<ul class="list">
									<li>[예약 기간]<br> ・최소 2시간부터 최장 30일까지 예약이 가능합니다.
									</li>
									<li>[입차 시간]<br> ・예약시간 기준 2시간 전 및 예약시간 기준 2시간 후 까지는
										예약변경 없이 입차가 가능합니다.
									</li>
									<li>[예약 변경/취소]<br> ・예약의 변경 및 취소는 입차 예정시간 1시간 전까지
										가능합니다. <br>・입차 예정시간 1시간 전 예약한 경우 20분이내에는 예약의 변경 및 취소가
										가능합니다.
									</li>
									<li class="colorType green">[예약부도 및 패널티]<br> ・입차 예정시간
										2시간 경과까지 입차하지 않는 경우 예약 보증금의 100%를 위약금으로 하며, 예약이 취소됩니다. <br>
										・예약일 기준 1년간 2회 이상 예약부도 시 예약 출차일로부터 3개월 동안 공항 주차 예약서비스를 이용할 수
										없습니다.
									</li>
									<li class="showText" style="display: block;">[장애인 차량]<br>
										・장애인 차량 주차면이 별도로 마련되어 있습니다. (엘리베이터 및 에스컬레이터 없음)
									</li>
									<li>[주차요금]<br> ・주차요금은 실제 입출차 시간을 기준으로 부과됩니다.
									</li>
								</ul>
								<ul class="list">
									<li class="colorType dkBlue">예상 주차요금 계산기</li>
									<li>[할인적용]<br> ・할인은 출차(유인, 무인) 시 증빙 후 적용됩니다.
									</li>
								</ul>
							</div>
						</div>
						<div class="parkCheckDiv" style="display: none;">
							<!--//reserve-->
							<div class="table type01 web">
								<table>
									<caption>주차조회 테이블이며, 예약가능여부, 선결제 할인주차요금 등을 나타냅니다.</caption>
									<colgroup>
										<col style="width: 19%;">
										<col style="width: auto">
										<col style="width: 19%;">
										<col style="width: auto">
									</colgroup>
									<tbody id="checkResult">
									</tbody>
								</table>
							</div>
							<!--//table-->
							<!--table-->
							<div class="table type01 mt40 mobile">
								<table>
									<caption>주차조회 테이블이며, 예약가능여부, 선결제 할인주차요금 등을 나타냅니다.</caption>
									<colgroup>
										<col style="width: 48%;">
										<col style="width: auto">
									</colgroup>
									<tbody id="checkResultMobile">
									</tbody>
								</table>
							</div>
						</div>
						<!--//table-->
						<!-- 								<p class="colorType green">※ 조회하신 입차/ 출차 일시 기준 사전결제에 대한 할인 금액으로, 실제 입차 및 출차 시간 변동에 따라 주차요금이 상이할 수 있습니다.</p> -->
						<!--btnArea-->
						<div class="btnArea txt-center mt40" id="btnAdd"
							style="display: none;">
							<button type="button" class="button white" id="requestBtn">다음단계</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</form>
</div>
<script>
	$(function() {
		var msg = "";

		if (msg != "") {
			alertMessage(msg);
		}

		if ($("#parkingDivCd").val() != "" && $("#carKind").val() != ""
				&& $("#resInDttm").val() != "" && $("#resOutDttm").val() != "") {
			rescheck("2");
		}

		//다음단계 버튼 숨김처리
		$("#btnAdd").hide();
		$(".parkCheckDiv").hide();



		var parkingDivCd = $("#parkingDivCd").val();

		$('#parkingDivCd').selectLink({
			dst : $('#parkingNm'),
			url : '/reservation/parkingList.json',
			emptyValue : {
				value : '',
				label : '주차장 선택',
				selected : "selected"
			},
			paramFn : function($me) {
				if ($me.val() != "PLT-003") {
					$(".showText").css("display", "block");
					$(".showText").prop("disabled", false);
				} else {
					$(".showText").css("display", "none");
					$(".showText").prop("disabled", true);
					$("#carKind").val("DC001")
				}
				return {
					parkingDivCd : $me.val(),
					puOrgnCd : $('#puOrgnCd').val()
				}
			}
		}).trigger('change');

		$(".cal").datetimepicker({
			//format: 'Y-m-d H:00:00'
			format : 'Y-m-d H:i:00',
			formatTime : 'H:i',
			formatDate : 'Y/m/d',
			step : 10,
		});

		$("#calcResInDttm").datetimepicker({
			//format: 'YYYY-MM-DD HH:mm:ss'
			format : 'Y-m-d H:i:00',
			formatTime : 'H:i',
			formatDate : 'Y/m/d',
			step : 10,
		});

		$("#calcResOutDttm").datetimepicker({
			//format: 'YYYY-MM-DD HH:mm:ss'
			format : 'Y-m-d H:i:00',
			formatTime : 'H:i',
			formatDate : 'Y/m/d',
			step : 10,
		});

		/*
			조회하기 버튼
		 */
	     $("#parkCheckBtn").click(function() {
	            const parkingNm = $("#parkingNm").val();
	            const resInDttm = $("#resInDttm").val();
	            const resOutDttm = $("#resOutDttm").val();
	            const carKind = $("#carKind").val();

	            if (!parkingNm) {
	                alert("주차장을 선택해주세요.");
	                return;
	            }
	            if (!resInDttm) {
	                alert("입차일자를 선택해주세요.");
	                return;
	            }
	            if (!resOutDttm) {
	                alert("출차일자를 선택해주세요.");
	                return;
	            }

	            rescheck(parkingNm);
	        });

	
		/*
			주차요금 간편계산 - 다시계산하기 버튼
		 */
	

		/*
			다음단계 버튼
		 */
		$("#requestBtn").click(function() {

			var airportNm = $("#parkingDivCd option:selected").text();
			var parkingNm = $("#parkingNm option:selected").text();
			var sectnId = $("#parkingNm option:selected").text();

			$("#airportNm").val(airportNm);
			$("#parkingName").val(parkingNm);

			$("#reservationVO").attr("action", "/reservation/resInsert.do");
			$("#reservationVO").submit();

		});

		//예약정보 변경시 예약가능여부 숨김처리
		$(".ck").click(function() {
			$("#btnAdd").hide();
			$(".parkCheckDiv").hide();
		});

		$("#resInDttm").focusout(function() {
			var time = $("#resInDttm").val().substring(15, 16)
			if ($("#resInDttm").val() != "" && time != "0") {
				$("#resInDttm").val("");
				alert("입차 시간을 선택해주세요.");
			}
		});

		$("#resOutDttm").focusout(function() {
			var time = $("#resOutDttm").val().substring(15, 16)
			if ($("#resOutDttm").val() != "" && time != "0") {
				$("#resOutDttm").val("");
				alert("출차 시간을 선택해주세요.");
			}
		});

	});

	/**
	 * 숫자 콤마를 적용후 돌려준다.
	 * @param x
	 * @returns
	 */
	function numberWithCommas(x) {
		return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
	}

	function rescheck(sectnId) {
		var target = $("#checkResult");
		var mbtarget = $("#checkResultMobile");
		var text = "";
		var mbtext = "";
		var carKind = $("#carKind").val();
		var inDttm = $("#resInDttm").val();
		var outDttm = $("#resOutDttm").val();
		var date = new Date();
		date.setHours(0);
		date.setMinutes(0);
		date.setSeconds(0);
		var limitDt = moment(date).add(45, 'days').format("YYYY-MM-DD");
		var resLimitDt = moment(inDttm).add(30, 'days').format("YYYY-MM-DD");

		if (sectnId == "") {
			alert("주차장을 선택해주세요.")
		} else if (carKind == "") {
			alert("차량종류를 선택해주세요.")
		} else if (inDttm == null || inDttm == "") {
			alert("입차일자를 선택해주세요.");
		} else if (outDttm == null || outDttm == "") {
			alert("출차일자를 선택해주세요.");
		} else if (moment(outDttm).diff(moment(inDttm), 'hours') < 2) {
			alert("예약기간은 최소 2시간 이상 신청하셔야 합니다.");
		} else if (moment(outDttm).diff(moment(inDttm), 'days') > 30) {
			alert("주차예약은 예약 입차일시 기준 최대 30일까지 사용 시 예약 가능합니다. (" + resLimitDt
					+ "까지 선택 가능)");
		} else if (moment(inDttm) <= moment(new Date())) {
			alert("예약 입차일시는 현재시간 이후여야 합니다.");
		} else if (moment(inDttm).diff(moment(date), 'days') > 45) {
			alert("예약신청일(오늘) 기준 45일 이내 출차일자 지정만 가능합니다. \n※ 현재기준  " + limitDt
					+ "까지 선택가능");
		} else if (moment(outDttm).diff(moment(date), 'days') > 45) {
			alert("예약신청일(오늘) 기준 45일 이내 출차일자 지정만 가능합니다. \n※ 현재기준  " + limitDt
					+ "까지 선택가능");
		} else {
			$
					.ajax({
						url : "/parking/reservationCheck.json",
						type : "POST",
						dataType : "json",
						data : {
							sectnId : sectnId,
							resInDttm : $("#resInDttm").val(),
							resOutDttm : $("#resOutDttm").val(),
							carKind : $("#carKind").val()
						},
						success : function(data) {
							$(".parkCheckDiv").show();
							console.log(data)
							var fullChkCode = data.result.code;
							var content = "";
							var mbcontent = "";
							var btn = "";

							if (fullChkCode == "00") {
								content += "<td>예약가능</td>"
								/* +  "<th scope='row'>예약가능 주차면수</th>"
								+  "<td>" + data.result.result.possibleNormalCnt + "대</td>"; */

								mbcontent += "<td>예약가능</td>" + "</tr>" + "<tr>"
								/* +  "<th scope='row'>예약가능 주차면수</th>"
								+  "<td>" + data.result.result.possibleNormalCnt + "대</td>"; */

								$("#btnAdd").show();

							} else {
								content = "<td>예약불가능 (선택일시 예약주차장 만차) <li class='colorType green'>*예약주차장 외 여객 주차장은 예약 없이 이용 가능(단, 만차 시 대기 발생 할수 있음)</li></td>";

								mbcontent = "<td>예약불가능 (선택일시 예약주차장 만차) <li class='colorType green'>*예약주차장 외 여객 주차장은 예약 없이 이용 가능(단, 만차 시 대기 발생 할수 있음)</li></td>";

								$("#btnAdd").hide();
							}

							text += "<tr>" + "<th scope='row'>예약가능여부</th>"
									+ content + "</tr>";

							mbtext += "<tr>" + "<th scope='row'>예약가능여부</th>"
									+ mbcontent + "</tr>";
							target.empty().append(text);
							mbtarget.empty().append(mbtext);

							//하단으로 내리는 이벤트
							$("html, body").animate({
								scrollTop : $(document).height()
							}, 500);
						},
						error : function(request, error) {
							$.loadingStop();
							$("#btnAdd").hide();
							alertMesage("서버와의 통신이 끊어졌습니다.");
						}
					});
		}
	}
</script>